name: '[Util] Import & Sync Data'
run-name: >
  ${{ (github.event.client_payload.auth0_sync_tenant || inputs.auth0_sync_tenant) && format('Syncing Auth0 {0} tenant', github.event.client_payload.auth0_dest_tenant || inputs.auth0_dest_tenant) || '' }}
  ${{ (github.event.client_payload.firebase_sync_rc || inputs.firebase_sync_rc) && format(' Syncing Firebase {0}', github.event.client_payload.firebase_dest_env || inputs.firebase_dest_env) || '' }}

on:
  repository_dispatch:
    types: 
      - Trigger-Import-Sync-Data

  workflow_dispatch:
    inputs:
      auth0_sync_tenant:
        description: "Sync AUTH0 Tenants"
        required: true
        default: false
        type: boolean
      auth0_dest_tenant:
        description: 'Auth0 Target Tenant'
        required: true
        type: choice
        options:
          - stage
          - prod
      firebase_sync_rc:
        description: "Sync Firebase Remote Config"
        required: true
        type: boolean
        default: false
      firebase_dest_env:
        description: 'Firebase Target Environment'  
        required: true
        type: choice
        options:
          - prod

jobs:
  set_env:
    name: 'Setup Inputs'
    uses: nabarun-ngo/ngo-nabarun-templates/.github/workflows/Setup-Env.yml@main
    with:
      inputs: ${{ toJson(inputs) }}
      client_payload: ${{ toJson(github.event.client_payload) }}

  sync_data:
    name: 'Sync Data'
    needs: set_env
    uses: nabarun-ngo/ngo-nabarun-templates/.github/workflows/Sync-Data.yml@main
    with:
      auth0_target_env: ${{ fromJson(needs.set_env.outputs.variables).auth0_dest_tenant }}
      firebase_target_env: ${{ fromJson(needs.set_env.outputs.variables).firebase_dest_env }}
      sync_auth0: ${{ fromJson(needs.set_env.outputs.variables).auth0_sync_tenant }}
      sync_firebaseRC: ${{ fromJson(needs.set_env.outputs.variables).firebase_sync_rc }}
      firebase_source_project: ${{ vars.FB_PROJECT_ID_SOURCE }}
      firebase_target_project: ${{ vars.FB_PROJECT_ID }}
    secrets:
      auth0_source_config : ${{ secrets.AUTH0_CONFIG_SOURCE }}
      auth0_dest_config : ${{ secrets.AUTH0_CONFIG }}
      firebase_service_account_source: ${{ secrets.FB_SA_KEY_SOURCE }}
      firebase_service_account_target: ${{ secrets.FB_SA_KEY }}

  

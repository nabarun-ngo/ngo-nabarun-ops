name: '[Util] Redis Cache Management'
on:
  workflow_dispatch:
    inputs:
      action:
        description: "Choose action: view, delete, ping"
        required: true
        default: "ping"
        type: choice
        options:
          - view
          - delete
          - ping
      key:
        description: "Specify Redis key to delete (only for delete action)"
        required: false
        default: ""

jobs:
   redis-ops:
    name: 'Redis Operations'
    runs-on: ubuntu-latest
    environment: 'prod'
    if: ${{ github.event.inputs.action != 'ping' }}
    steps:
    - name: View Redis Keys
      uses: nabarun-ngo/ngo-nabarun-templates/.github/actions/redis-view-keys@main
      with:
        redis_host: ${{ secrets.REDIS_HOST }}
        redis_port: ${{ secrets.REDIS_PORT }}
        redis_password: ${{ secrets.REDIS_PASSWORD }}

    - name: Call Redis Delete Keys
      if: ${{ github.event.inputs.action == 'delete' }}
      uses: nabarun-ngo/ngo-nabarun-templates/.github/actions/redis-delete-keys@main
      with:
        key: ${{ github.event.inputs.key }}
        redis_host: ${{ secrets.REDIS_HOST }}
        redis_port: ${{ secrets.REDIS_PORT }}
        redis_password: ${{ secrets.REDIS_PASSWORD }}

   redis-ping:
    name: 'Redis Ping'
    runs-on: ubuntu-latest
    if: ${{ github.event.inputs.action == 'ping' }}
    steps:
    - name: Redis Ping Pong
      uses: nabarun-ngo/ngo-nabarun-templates/.github/actions/redis-ping-pong@main
      with:
        redis_host: ${{ secrets.REDIS_HOST }}
        redis_port: ${{ secrets.REDIS_PORT }}
        redis_password: ${{ secrets.REDIS_PASSWORD }}
